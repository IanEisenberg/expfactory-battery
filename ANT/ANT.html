<html>
  <head>
    <title>My experiment</title>
    <script src="../General/js/jquery-1.11.3.js"></script>
    <script src="../General/jspsych-4.2/jspsych.js"></script>
    <script src="../General/jspsych-4.2/plugins/jspsych-text.js"></script>
    <script src="../General/jspsych-4.2/plugins/jspsych-instructions.js"></script>
    <script src="../General/jspsych-4.2/plugins/jspsych-single-stim.js"></script>
    <script src="../General/jspsych-4.2/plugins/jspsych-stim-feedback-IE.js"></script>
    <link href="../General/jspsych-4.2/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <link href="../General/css/default_style.css" rel="stylesheet" type="text/css"></link>
    <link href="ANT.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body>
  </body>
  <script>

    /* define welcome message block */
    var welcome_block = {
      type: 'text',
      text: '<div class = centerbox><p class = block-text>Welcome to the experiment. Press any key to begin.</p></div>'
    };
    
    var correct_responses = jsPsych.randomization.repeat([["left arrow",37],["right arrow",39]],1)
    
    /* define instructions block */
    var instructions_block = {
      type: 'instructions',
      pages: [
        '<div class = centerbox><p class = block-text>If you see red, press the ' + correct_responses[0][0] + '. Press <strong>enter</strong> to continue.</p></div>',
        '<div class = centerbox><p class = block-text>If you see red, press the ' + correct_responses[1][0] + '. Press <strong>enter</strong> to continue.</p></div>'
        ],
      key_forward: 13
    };

    /* define test block */
    var locations = ['up', 'down']
    var cues = ['nocue', 'center', 'double', 'spatial']
    test_stimuli = []
    for (l = 0; l < locations.length; l++) {
        var loc = locations[l]
        for (ci = 0; ci < cues.length; ci++) {
            var c = cues[ci]
            stims = [
              {
                image: '<div class = centerbox><p class = ANT_text>+</p></div><div class = ANT_' + loc + '><p class = ANT_text> &mdash; &mdash; &larr; &mdash; &mdash;</p></div></div>',
                data: {correct_response: 37, direction: 'left', flanker: 'neutral', location: loc, cue: c, trial_id: 'ANT_trial'}
              }, 
              {
                image: '<div class = centerbox><p class = ANT_text>+</p></div><div class = ANT_' + loc + '><p class = ANT_text> &larr; &larr; &larr; &larr; &larr; </p></div></div>',
                data: {correct_response: 37, direction: 'left', flanker: 'congruent', location: loc, cue: c, trial_id: 'ANT_trial'}
              }, 
              {
                image: '<div class = centerbox><p class = ANT_text>+</p></div><div class = ANT_' + loc + '><p class = ANT_text> &rarr; &rarr; &larr; &rarr; &rarr; </p></div></div>',
                data: {correct_response: 37, direction: 'left', flanker: 'incongruent', location: loc, cue: c, trial_id: 'ANT_trial'}
              }, 
              {
                image: '<div class = centerbox><p class = ANT_text>+</p></div><div class = ANT_' + loc + '><p class = ANT_text> &mdash; &mdash; &rarr; &mdash; &mdash; </p></div></div>',
                data: {correct_response: 39,direction: 'right', flanker: 'neutral', location: loc, cue: c, trial_id: 'ANT_trial'}
              }, 
              {
                image: '<div class = centerbox><p class = ANT_text>+</p></div><div class = ANT_' + loc + '><p class = ANT_text> &rarr; &rarr; &rarr; &rarr; &rarr; </p></div></div>',
                data: {correct_response: 39, direction: 'right', flanker: 'congruent', location: loc, cue: c, trial_id: 'ANT_trial'}
              }, 
              {
                image: '<div class = centerbox><p class = ANT_text>+</p></div><div class = ANT_' + loc + '><p class = ANT_text> &larr; &larr; &rarr; &larr; &larr; </p></div></div>',
                data: {correct_response: 39, direction: 'right', flanker: 'incongruent', location: loc, cue: c, trial_id: 'ANT_trial'}
              }
          ]
          for (i= 0; i < stims.length; i++) {
            test_stimuli.push(stims[i])
          }
        }
    }
    

    var all_trials = jsPsych.randomization.repeat(test_stimuli, 2, true);
    var response_array = [];
    for (i = 0; i < all_trials.data.length; i++) {
        response_array.push(all_trials.data[i]['correct_response'])
    }
	
    var post_trial_gap = function() {
	  var curr_trial = jsPsych.progress().current_trial_global
	  console.log(3500 - jsPsych.data.getData()[curr_trial - 1].rt - experiment[curr_trial - 4].timing_stim)
      return 3500 - jsPsych.data.getData()[curr_trial - 1].rt - experiment[curr_trial - 4].timing_stim
    }
	
    
    /* create fixation definition array */
    var fixation = {
      type: 'single-stim',
      stimuli: '<div class = centerbox><p class = ANT_text>+</p></div>',
      is_html: true,
      choices: 'none',
      data: {trial_id: 'fixation'},
      timing_post_trial: 0,
      timing_stim: 400,
      timing_response: 400
    }
    
    var no_cue = {
      type: 'single-stim',
      stimuli: '<div class = centerbox><p class = ANT_text>+</p></div>',
      is_html: true,
      choices: 'none',
      data: {trial_id: 'fixation'},
      timing_post_trial: 0,
      timing_stim: 100,
      timing_response: 100
    }
    
    var center_cue = {
      type: 'single-stim',
      stimuli: '<div class = centerbox><p class = ANT_text>*</p></div>',
      is_html: true,
      choices: 'none',
      data: {trial_id: 'fixation'},
      timing_post_trial: 0,
      timing_stim: 100,
      timing_response: 100
    }
    
    var double_cue = {
      type: 'single-stim',
      stimuli: '<div class = centerbox><p class = ANT_text>+</p></div><div class = ANT_down><p class = ANT_text>*</p></div><div class = ANT_up><p class = ANT_text>*</p></div></div>',
      is_html: true,
      choices: 'none',
      data: {trial_id: 'fixation'},
      timing_post_trial: 0,
      timing_stim: 100,
      timing_response: 100
    }
    

        
    /* create experiment definition array */
    var experiment = [];
    experiment.push(welcome_block);
    experiment.push(instructions_block);
    
    for (i = 0; i < all_trials.data.length; i++) {
        var first_fixation_gap = Math.floor( Math.random() * 1200 ) + 400;
		var first_fixation = {
		  type: 'single-stim',
		  stimuli: '<div class = centerbox><p class = ANT_text>+</p></div>',
		  is_html: true,
		  choices: 'none',
		  data: {trial_id: 'fixation'},
		  timing_post_trial: 0,
		  timing_stim: first_fixation_gap,
		  timing_response: first_fixation_gap
		}
        experiment.push(first_fixation)
                
        if (all_trials.data[i].cue == 'nocue') {
            experiment.push(no_cue)
        } else if (all_trials.data[i].cue == 'center') {
            experiment.push(center_cue)
        } else if (all_trials.data[i].cue == 'double') {
            experiment.push(double_cue)
        } else {
            var spatial_cue = {
              type: 'single-stim',
              stimuli: '<div class = centerbox><div class = ANT_' + all_trials.data[i].location +'><p class = ANT_text>*</p></div></div>',
              is_html: true,
              choices: 'none',
              data: {trial_id: 'fixation'},
              timing_post_trial: 0,
              timing_stim: 100,
              timing_response: 100
            }
            experiment.push(spatial_cue)
        }
        experiment.push(fixation)
		
		var practice_trial = {
          type: 'stim-feedback',
          stimuli: all_trials.image[i],
          is_html: true,
          key_answer: response_array[i],
          correct_text: '<div class = centerbox><p class = center-text>Correct</p></div>',
          incorrect_text: '<div class = centerbox><p class = center-text>Incorrect</p></div>',
          noresponse_text: '<div class = centerbox><p class = center-text>Response faster!</p></div>',
          choices: [37,39],
          data: all_trials.data[i],
          timing_response: 1700, 
          timing_stim: 1700,
          timing_feedback_duration: 1000,
          show_stim_with_feedback: false,
          timing_post_trial: 0
        }
        experiment.push(practice_trial)
		
		var last_fixation = {
		  type: 'single-stim',
		  stimuli: '<div class = centerbox><p class = ANT_text>+</p></div>',
		  is_html: true,
		  choices: 'none',
		  data: {trial_id: 'fixation'},
		  timing_post_trial: 0,
		  timing_stim: post_trial_gap,
		  timing_response: post_trial_gap
		}
		experiment.push(last_fixation)
    }

   

    /* start the experiment */
    jsPsych.init({
      experiment_structure: experiment,
      on_finish: function() {
        jsPsych.data.localSave('ANT_test_save.csv','csv');
      }
    });
  </script>
</html>
